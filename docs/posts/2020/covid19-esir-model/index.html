<!DOCTYPE html>
<html lang="en">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    
    
    
    <link rel="preconnect" href="https://www.googletagmanager.com">
    <link rel="preconnect" href="https://www.google-analytics.com">

    <script async src="https://www.googletagmanager.com/gtag/js?id=G-97N9TLJ517"></script>
    <script async>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-97N9TLJ517');
    </script>
    

    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="StatWizard: Access beginner-friendly blog posts covering various applications of statistics, data science, computer programming and finance. Also hosts the personal website of the author, Subhrajyoty Roy.">
    <link rel="icon" href="/images/logo.png">
    <title>
        
Analysis of basic Epidemiological models - Part 2

    </title>

    

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap" rel="stylesheet">


<script src="https://code.jquery.com/jquery-3.7.0.min.js" integrity="sha256-2Pmvv0kuTBOenSvLm6bvfBSSHrUJ+3A7x6P5Ebd07/g=" crossorigin="anonymous"></script>


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css">




<link rel="stylesheet" type="text/css" href="//localhost:1313/css/index.d00060bc9039e90bdce025261a696154.css" />






<script src="https://unpkg.com/typed.js@2.0.16/dist/typed.umd.js"></script>


<style>
  html {
      scroll-behavior: smooth;
  }
  
  .roboto-thin {
    font-family: "Roboto", sans-serif;
    font-weight: 100;
    font-style: normal;
  }

  .roboto-light {
    font-family: "Roboto", sans-serif;
    font-weight: 300;
    font-style: normal;
  }

  .roboto-regular {
    font-family: "Roboto", sans-serif;
    font-weight: 400;
    font-style: normal;
  }

  .roboto-medium {
    font-family: "Roboto", sans-serif;
    font-weight: 500;
    font-style: normal;
  }

  .roboto-bold {
    font-family: "Roboto", sans-serif;
    font-weight: 700;
    font-style: normal;
  }

  .roboto-black {
    font-family: "Roboto", sans-serif;
    font-weight: 900;
    font-style: normal;
  }

  .roboto-thin-italic {
    font-family: "Roboto", sans-serif;
    font-weight: 100;
    font-style: italic;
  }

  .roboto-light-italic {
    font-family: "Roboto", sans-serif;
    font-weight: 300;
    font-style: italic;
  }

  .roboto-regular-italic {
    font-family: "Roboto", sans-serif;
    font-weight: 400;
    font-style: italic;
  }

  .roboto-medium-italic {
    font-family: "Roboto", sans-serif;
    font-weight: 500;
    font-style: italic;
  }

  .roboto-bold-italic {
    font-family: "Roboto", sans-serif;
    font-weight: 700;
    font-style: italic;
  }

  .roboto-black-italic {
    font-family: "Roboto", sans-serif;
    font-weight: 900;
    font-style: italic;
  }
</style>


<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>

     
     
</head>
<body>
    <div class="app-container min-h-[100vh] flex flex-col justify-between">
        <nav class="bg-white shadow-xl z-50">
  
  <div
    class="hidden mx-auto max-w-7xl py-2 px-4 md:px-6 lg:px-8 md:flex flex-row items-center"
  >
    <div class="w-[200px] flex items-center">
      <a
        class="uppercase font-extrabold font-mono text-2xl flex flex-row justify-center items-center gap-2"
        href="/"
      >
        <img
          src="/images/logo-wide-resized.png"
          height="50px"
          width="100px"
          class="inline-block"
          alt="StatWizard Logo"
        />
      </a>
    </div>
    <div class="w-full flex flex-row justify-center items-center gap-4">
      
      <a
        href="/"
        class="px-4 py-2 rounded-t-lg hover:bg-gray-100 hover:border-b-2 hover:border-blue-700 roboto-medium"
      >
        Home
      </a>
      
      <a
        href="/posts"
        class="px-4 py-2 rounded-t-lg hover:bg-gray-100 hover:border-b-2 hover:border-blue-700 roboto-medium"
      >
        Posts
      </a>
      
      <a
        href="/aboutme"
        class="px-4 py-2 rounded-t-lg hover:bg-gray-100 hover:border-b-2 hover:border-blue-700 roboto-medium"
      >
        About Me
      </a>
      
      <a
        href="/#contact-me"
        class="px-4 py-2 rounded-t-lg hover:bg-gray-100 hover:border-b-2 hover:border-blue-700 roboto-medium"
      >
        Contact Me
      </a>
      
    </div>
    <div class="w-[200px] flex flex-row justify-around items-center">
      
      <a
        href="mailto:subhrajyotyroy@gmail.com"
        class="hover:text-gray-600 transition-all ease-in-out"
        aria-label="fas fa-envelope for link mailto:subhrajyotyroy@gmail.com"
        target="_blank"
      >
        <i class="fas fa-envelope fa-lg"></i>
      </a>
      
      <a
        href="https://www.facebook.com/subroy13/"
        class="hover:text-gray-600 transition-all ease-in-out"
        aria-label="fab fa-facebook for link https://www.facebook.com/subroy13/"
        target="_blank"
      >
        <i class="fab fa-facebook fa-lg"></i>
      </a>
      
      <a
        href="https://github.com/subroy13"
        class="hover:text-gray-600 transition-all ease-in-out"
        aria-label="fab fa-github for link https://github.com/subroy13"
        target="_blank"
      >
        <i class="fab fa-github fa-lg"></i>
      </a>
      
      <a
        href="https://www.linkedin.com/in/subroy13"
        class="hover:text-gray-600 transition-all ease-in-out"
        aria-label="fab fa-linkedin-in for link https://www.linkedin.com/in/subroy13"
        target="_blank"
      >
        <i class="fab fa-linkedin-in fa-lg"></i>
      </a>
      
      <a
        href="#"
        class="hover:text-gray-600 transition-all ease-in-out"
        aria-label="fab fa-instagram for link #"
        target="_blank"
      >
        <i class="fab fa-instagram fa-lg"></i>
      </a>
      
    </div>
  </div>

  
  <div
    class="flex py-4 px-2 max-w-7xl flex-row justify-end items-center md:hidden"
  >
    <div class="w-full flex justify-center items-center">
      <p class="uppercase font-extrabold font-mono text-2xl">
        StatWizard
      </p>
    </div>
    <div class="w-[30px] mr-4 relative">
      <button
        type="button"
        id="mobile-menu-button"
        class="inline-flex items-center justify-center rounded-md p-2 text-gray-400 hover:bg-gray-700 hover:text-white focus:outline-none"
        aria-controls="mobile-menu"
        aria-expanded="false"
      >
        <span class="sr-only">Open main menu</span>
        
        <svg
          id="mobile-menu-close-icon"
          class="bg-white text-neutral-800 outline-none block h-6 w-6"
          fill="none"
          viewBox="0 0 24 24"
          stroke-width="1.5"
          stroke="currentColor"
          aria-hidden="true"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5"
          />
        </svg>
        
        <svg
          id="mobile-menu-open-icon"
          class="bg-white text-neutral-800 outline-none hidden h-6 w-6"
          fill="none"
          viewBox="0 0 24 24"
          stroke-width="1.5"
          stroke="currentColor"
          aria-hidden="true"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M6 18L18 6M6 6l12 12"
          />
        </svg>
      </button>

      <div
        id="mobile-menu"
        class="absolute end-0 mt-4 -mr-4 bg-white w-[90vw] hidden"
      >
        <ul class="flex flex-col">
          
          <li
            class="px-4 sm:px-8 py-2 border first:rounded-t-lg last:rounded-b-lg hover:bg-gray-100"
          >
            <a href="/" class=""> Home </a>
          </li>
          
          <li
            class="px-4 sm:px-8 py-2 border first:rounded-t-lg last:rounded-b-lg hover:bg-gray-100"
          >
            <a href="/posts" class=""> Posts </a>
          </li>
          
          <li
            class="px-4 sm:px-8 py-2 border first:rounded-t-lg last:rounded-b-lg hover:bg-gray-100"
          >
            <a href="/aboutme" class=""> About Me </a>
          </li>
          
          <li
            class="px-4 sm:px-8 py-2 border first:rounded-t-lg last:rounded-b-lg hover:bg-gray-100"
          >
            <a href="/#contact-me" class=""> Contact Me </a>
          </li>
          
        </ul>
      </div>
    </div>
  </div>
</nav>

        

        <div class="content-container">
            



    <div class="relative h-[50vh] max-h-[300px] w-full bg-cover bg-center bg-no-repeat bg-fixed rounded-b-md" 
        style = "background-image: url('//localhost:1313/posts/2020/covid19-esir-model/featured.webp')">
        
            <div class = "absolute top-0 left-0 bg-neutral-800/100 w-fit text-white p-1 ml-1 font-xs rounded-md">
                <p>Cover image taken from <a href="https://edition.cnn.com/2020/03/24/world/coronavirus-newsletter-03-24-20/index.html">CNN.com</a></p>
            </div>
        
    </div>



<div class="mt-4 flex flex-col gap-4 mx-2 px-2 md:mx-4 md:px-8">
    <h1 class="text-3xl text-center text-neutral-600 font-bold md:px-8 md:pt-6">
        Analysis of basic Epidemiological models - Part 2
    </h1>
    <div class="m-2 p-4 rounded-lg shadow-lg border-2">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div class="flex flex-col justify-center items-center gap-2">   
                <div class="mt-1 flex flex-row text-neutral-800 gap-4">
                    <p class="font-bold">Date:</p>
                    <p class="font-normal">01 April, 2020</p>
                </div> 
                <p class="mt-1 text-neutral-600">
                    <span class="font-bold">22</span> minutes read
                </p>
                <div class="my-1">
                    
                        <a href="//localhost:1313/tags/epidemiology/" 
                            class = "inline-block bg-gray-200 rounded-full px-3 py-1 text-sm font-base text-gray-700 mr-2 mb-2
                            hover:underline hover:bg-gray-300 transition ease-in-out">
                            Epidemiology
                        </a>
                    
                </div>    
            </div>
            <div class="flex flex-col justify-start gap-2">
                <h1 class="text-lg font-bold">Prerequisites</h1>
                <ul class="space-y-2 text-left">
                    
                    <li class="flex items-center space-x-3">
                        <svg class="flex-shrink-0 w-3 h-3 text-green-500" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 12">
                            <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M1 5.917 5.724 10.5 15 1.5"/>
                        </svg>
                        <span>R Programming - </span>
                        
                            <span class="text-yellow-600 font-semibold">Intermediate</span>
                        
                    </li>
                    
                    <li class="flex items-center space-x-3">
                        <svg class="flex-shrink-0 w-3 h-3 text-green-500" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 12">
                            <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M1 5.917 5.724 10.5 15 1.5"/>
                        </svg>
                        <span>Statistical Parametric Inference - </span>
                        
                            <span class="text-green-600 font-semibold">Beginner</span>
                        
                    </li>
                    
                    <li class="flex items-center space-x-3">
                        <svg class="flex-shrink-0 w-3 h-3 text-green-500" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 12">
                            <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M1 5.917 5.724 10.5 15 1.5"/>
                        </svg>
                        <span>Bayesian Statistics - </span>
                        
                            <span class="text-yellow-600 font-semibold">Intermediate</span>
                        
                    </li>
                    
                </ul>
            </div>    
        </div>
        <p class="mt-4 p-4 text-sm">
            <span class="font-semibold">Summary: </span> In this post, we describe a slight generalization of the basic SIR model of epidemiology and its estimation procedure under both frequentist and Bayesian paradigms. We also make projections of the covid cases over next several days based on the fitted model.
        </p>
    </div>
    <div class="grid grid-cols-1 md:grid-cols-4 gap-2">
        <div class="relative col-span-1">
            <div class="sticky top-0 left-0 w-full pl-4 pt-4">
                <h1 class="text-bold text-xl">Table of Contents</h1>
                <div class="prose">
                    <nav id="TableOfContents">
  <ul>
    <li><a href="#initialization">Initialization</a></li>
    <li><a href="#performing-mcmc">Performing MCMC</a>
      <ul>
        <li><a href="#defining-the-jags-code">Defining the JAGS Code</a></li>
        <li><a href="#running-the-gibbs-sampler">Running the Gibbs Sampler</a></li>
      </ul>
    </li>
    <li><a href="#forecasting-using-esir-model">Forecasting using eSIR model</a>
      <ul>
        <li><a href="#extract-components-of-mcmc-samples">Extract components of MCMC samples</a></li>
        <li><a href="#perform-forecasting">Perform Forecasting</a></li>
        <li><a href="#derivation-of-3-important-dates">Derivation of 3 important dates</a></li>
        <li><a href="#summarising-the-forecast-outputs">Summarising the forecast outputs</a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li><a href="#performance-for-italy">Performance for Italy</a></li>
    <li><a href="#estimation-for-india">Estimation for India</a></li>
  </ul>
</nav>
                </div>
            </div>
        </div>
        <div class="col-span-3">
            <div class="text-justify break-words w-full">
                <div class="prose" style="max-width: none;">
                    <h1 id="introduction">Introduction</h1>
<p>In the <a href="../covid19-SIR-model/">part 1</a> of this post, we noted that the SIR model is incapable of capturing the time-varying nature of the disease spread, due to the nationwide lockdowns and quanrantine procedures.</p>
<p>In other words, SIR might be the best-case scenario, as it could produce an underestimate of the covid cases. Thus without any quarantining intervention, the situation looks grim; But all hope is not lost, as we&rsquo;ll show how different measures of quarantining, including lockdown, help decrease the rate of increase in confirmed cases. Taking cue from global powerhouses failing catastrophically to contain the onslaught on life that&rsquo;s been lunched by Covid-19, Prime Minister of India Shri Narendra Modi issued instructions for a nationwide <em>Lockdown</em> starting from 25 March'20 to 14 April'20, wth possible plans for further extension. The decision have been welcomed and lauded by various researchers and scientists alike, esopecially after countries like USA and Italy acted too late to a possibly aggravated situation. But why this praise? In this post, we&rsquo;ll find out how lockdown and other forms of quarantining helps contain the infection. But before that, a reminder of what we are up against: till date, Covid-19 virus has affected $722$ people in India, and $486702$ people worldwide and has claimed $16$ lives in India till now.</p>
<h1 id="loading-the-packages-and-the-dataset">Loading the Packages and the Dataset</h1>
<p>We are using the same dataset source as before, except that we have updated it to include some of the current observations. Similar to before, we shall be using <code>dplyr</code> for data manipulation and summarization, <code>lubridate</code> for handling dates and times, and <code>ggplot2</code> for plotting.</p>
<p>However, due to some Monte Carlo simulation later, we shall be needing <code>rjags</code> and we shall use <code>gtools</code> for specification of some useful probability distributions.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">library</span>(readr)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">library</span>(dplyr)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">library</span>(lubridate)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">library</span>(ggplot2)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">library</span>(rjags)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">library</span>(gtools)
</span></span></code></pre></div><p>Now, finally we load the updated dataset, which I have already downloaded from <a href="https://github.com/CSSEGISandData/COVID-19">JHU CSSE</a>, and manipulated to get the required form of data using the code discussed in my previous post <a href="https://subroy13.github.io/post/post6/">here</a>. We shall take a look at the last few columns to see how much we have updated.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>dat <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">read_csv</span>(<span style="color:#e6db74">&#39;./datasets/covid-19-data.csv&#39;</span>)
</span></span><span style="display:flex;"><span>knitr<span style="color:#f92672">::</span><span style="color:#a6e22e">kable</span>(<span style="color:#a6e22e">tail</span>(dat, <span style="color:#ae81ff">3</span>))
</span></span></code></pre></div><table>
<thead>
<tr>
<th>State</th>
<th>Country</th>
<th>Lat</th>
<th>Long</th>
<th>Date</th>
<th>Confirmed</th>
<th>Deaths</th>
<th>Recovered</th>
</tr>
</thead>
<tbody>
<tr>
<td>Zhejiang</td>
<td>China</td>
<td>29.1832</td>
<td>120.0934</td>
<td>2020-03-24</td>
<td>1240</td>
<td>1</td>
<td>1221</td>
</tr>
<tr>
<td>Zhejiang</td>
<td>China</td>
<td>29.1832</td>
<td>120.0934</td>
<td>2020-03-25</td>
<td>1241</td>
<td>1</td>
<td>1221</td>
</tr>
<tr>
<td>Zhejiang</td>
<td>China</td>
<td>29.1832</td>
<td>120.0934</td>
<td>2020-03-26</td>
<td>1243</td>
<td>1</td>
<td>1222</td>
</tr>
</tbody>
</table>
<h1 id="description-of-esir-model">Description of eSIR Model</h1>
<p>The eSIR (Extended SIR) model is really similar to the SIR model, except for the fact that it includes  a function that parametrizes the quarantining effects. As with SIR modelling, it has 3 different compartments, of states in which a person can be. This model has been developed very recently by <a href="https://www.medrxiv.org/content/10.1101/2020.02.29.20029421v1.full.pdf">Wang et al.</a> The states are as follows:</p>
<div class="mermaid">
    graph LR
    A(Susceptible) -->|"&#946&#960(t)"| B(Infected)
    B -->|&#947| C(Removed)
</div>
<p>As described in part 1, <strong>Susceptibles</strong> are the general population, who is susceptible to get the disease from an infectious person. <strong>Infected</strong> state reperesents the persons who have the symptoms of the infection and is able to spread it. And finally, <strong>Recovered / Removed</strong> is the state when a person is recovered from the disease and gain immunity to it, or is dead. Let, $Y_t^S, Y_t^I, Y_t^R$ denotes the proportion of people in these states respectively at the time $t$. Note that $Y_t^S + Y_t^I + Y_t^R = 1$.  $\pi(t)$ denotes the proportion of people transiting from <strong>Susceptible</strong> to <strong>Infected</strong> state at time $t$, with the <em>proportion</em> being commensurate to the proportion of people transiting from <strong>Susceptible</strong> to <strong>Infected</strong> state at time $t$ in the original SIR modelling. Thus We can vary $\pi(t)$ from time to time to perfectly capture the effect of quarantining. In other words, the rate at which a susceptible person becomes infected is not a time varying proportion, namely $\beta \pi(t)$, where $\beta$ is the usual rate of transmission of the disease, while $\pi(t)$ is the quarantining effect which might restrict movements of general public in order to make the effective transmission rate lower than the usual quantity $\beta$.</p>
<p>Let $\theta_t=(\theta_t^S, \theta_t^I, \theta_t^R)^T$ be the vector of underlying prevalence of the population in these three states. Since $Y_t^S, Y_t^I, Y_t^R$ are proportions, we model them via Beta distribution:</p>
<p>$$\begin{align}
Y_t^I \mid \theta_t, \tau \sim \text{Beta}(\lambda^I\theta_t^I,\lambda^I(1-\theta_t^I))\\\
&amp; \\\
Y_t^R \mid \theta_t, \tau \sim \text{Beta}(\lambda^R\theta_t^R,\lambda^R(1-\theta_t^R))\\\
\end{align}$$</p>
<p>where $\tau=(\beta, \gamma, \theta_0^T, \kappa, \lambda^I, \lambda^R)^T$, $\beta$, $\gamma$ are as in SIR model; $\kappa$, $\lambda^I, \lambda^R$ are parameters governing the latent process we&rsquo;ll define soon.</p>
<p>Since $\theta_t$ is a probability, we specify a Dirichlet model for it:</p>
<p>$$\theta_t \mid \theta_{t-1}, \tau \sim \text{Dirichlet} (k f(\theta_{t-1}, \beta, \gamma))$$</p>
<p>These together is called a Beta-Dirichlet State Space Model.</p>
<p>Here $f(\cdot)$ is the solution of the system of ODEs:</p>
<p>$$\begin{align}
\dfrac{d\theta_t^S}{dt} &amp; = -\pi(t)\beta \theta_t^S \theta_t^I\\\
&amp; \\\
\dfrac{d\theta_t^I}{dt} &amp; = \pi(t)\beta \theta_t^S \theta_t^I - \gamma \theta_t^I\\\
&amp; \\\
\dfrac{d\theta_t^R}{dt} &amp; = \gamma \theta_t^I\\\
\end{align}$$</p>
<p>and this is exactly where the SIR modelling takes place. We solve this system of ODEs via <em>Runge-Kutta</em>(RK4) approximation.</p>
<p>To implement the Markov Chain Monte Carlo method, we need to specify prior for the hyperparameters $\tau=(\beta, \gamma, \theta_0^T, \kappa, \lambda^I, \lambda^R)^{\top}$. We do that as follows:</p>
<p>We initialize $\theta_0$ via a distribution that uses the observed data:</p>
<p>$$\begin{align}
\theta_0^I \sim \text{Beta}(1, \dfrac{1}{Y_1^I})\\\
&amp; \\\
\theta_0^R \sim \text{Beta}(1, \dfrac{1}{Y_1^R})\\\
&amp; \\\
\theta_0^S= 1-\theta_0^I-\theta_0^R\\\
\end{align}$$</p>
<p>We specify the other hyperparameters according to the <a href="https://arxiv.org/pdf/1007.0908.pdf">SARS data</a> in Hong-Kong.</p>
<p>$$\begin{align}
R_0= \dfrac{\beta}{\gamma} \sim \text{Log}\mathbb{N}(1.099,0.096) \implies \mathbb{E}(R_0)=3.15, \mathbb{V}(R_0)=1 \\\
&amp; \\\
\gamma \sim \text{Log}\mathbb{N}(-2.955,0.910) \implies \mathbb{E}(\gamma)=0.0117, \mathbb{V}(\gamma)=0.01 \\\
&amp; \\\
k \sim \text{Gamma}(2, 0.0001)\\\
&amp;  \\\
\lambda^I \sim \text{Gamma}(2, 0.0001)\\\
&amp; \\\
\lambda^R \sim \text{Gamma}(2, 0.0001)\\\
\end{align}$$</p>
<p>Now suppose , data upto time point $t_0$ are observed: $(Y_1, \cdots Y_{t_0})$. We want to predict upto time point $T$. To this end, we generate $M$ MCMC samples, such that for $m \in {1,\cdots, M}$, $(Y_{t_0+1}^{(m)}, \cdots, Y_T)$ is a draw from $Y_t \mid \theta_t, \tau$. The algorihm is described below:</p>
<p><strong>Algorithm:</strong></p>
<p>for $m$ in $1, \cdots, M$</p>
<p>$\qquad$  for $t$ in $t_0+1,\cdots, T$,</p>
<p>$\qquad \qquad$  Draw $\theta_t^{(m)}$ from $[\theta_t \mid \theta_{t-1}^{(m)}, \tau^{(m)}]$</p>
<p>$\qquad \qquad$  Draw $Y_t^{(m)}$ from $[Y_t \mid \theta_{t}^{(m)}, \tau^{(m)} ]$</p>
<p>Finally for each time point $t$, $t= t_0+1,\cdots, T$ estimate $Y_t$ by $\hat{Y}_t=\dfrac{1}{M}\displaystyle \sum_{m=1}^M Y_t^{(m)}$.</p>
<h1 id="estimation-of-esir-model">Estimation of eSIR Model</h1>
<h2 id="initialization">Initialization</h2>
<p>Note that, we wish to have a lognormal distribution $R_0 \sim LogN(\mu, \sigma^2)$, such that, $E(R_0), Var(R_0)$ is at a specified value. The specific reason is that, $R_0 = \beta_0 / \gamma_0$, which is a positive quantity, hence is better modelled by a gamma or lognormal distribution than a normal distribution, which has support as the whole of real line. Therefore, given $E(R_0) = a$, and $Var(R_0) = b$, we wish to figure out $\mu, \sigma$, the parmeters of the lognormal distribution. This can be obtained through the following simple formula and is implemented in the following function.</p>
<p>$$\sigma^2 = \log\left( \dfrac{Var(R_0)}{E(R_0)^2} +1 \right) \qquad \qquad \mu = \log(E(R_0)) - \dfrac{\sigma^2}{2}$$</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>lognorm.param<span style="color:#f92672">&lt;-</span><span style="color:#66d9ef">function</span>(mu0,var0){
</span></span><span style="display:flex;"><span>  var <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">log</span>(var0<span style="color:#f92672">/</span>mu0^2<span style="color:#ae81ff">+1</span>)
</span></span><span style="display:flex;"><span>  mu <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">log</span>(mu0)<span style="color:#f92672">-</span>var<span style="color:#f92672">/</span><span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span>(<span style="color:#a6e22e">round</span>(<span style="color:#a6e22e">c</span>(mu,var),<span style="color:#ae81ff">3</span>))
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Now, we specify some control parameters, which specifies the initial $E(R_0), Var(R_0)$ and some other parameters, as well as the parameters for the markov chain (like the length of the chain, the number of parallel chains to construct in order to speed up the process, number of samples to define burn in period etc.) You may want to skip these technical details for now.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>init.params <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">list</span>(R0 <span style="color:#f92672">=</span> <span style="color:#ae81ff">3.15</span>, R0_sd <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>, gamma0 <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.0117</span>, gamma0_sd <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.1</span>)
</span></span><span style="display:flex;"><span>control.params <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">list</span>(nchain<span style="color:#f92672">=</span><span style="color:#ae81ff">4</span>, nadapt<span style="color:#f92672">=</span><span style="color:#ae81ff">1e4</span>, ndraw<span style="color:#f92672">=</span><span style="color:#ae81ff">5e2</span>, thin<span style="color:#f92672">=</span><span style="color:#ae81ff">10</span>, nburnin<span style="color:#f92672">=</span><span style="color:#ae81ff">2e2</span>)
</span></span><span style="display:flex;"><span>control.params<span style="color:#f92672">$</span>mclen <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">round</span>(control.params<span style="color:#f92672">$</span>ndraw <span style="color:#f92672">/</span> control.params<span style="color:#f92672">$</span>thin) <span style="color:#f92672">*</span> control.params<span style="color:#f92672">$</span>nchain    <span style="color:#75715e">#number of MCMC draws in total</span>
</span></span></code></pre></div><h2 id="performing-mcmc">Performing MCMC</h2>
<p>Now, we shall be creating a function called <code>do.MCMC</code> which takes the observed proportion of Infected (I), Removed ( R ), then the value of the function $\pi(t)$ till the observed time period (and the control parameters). Then, it shall perform the MCMC step by generating the posterior sampels, and it shall output that posterior samples, which we shall later use to generate predictions, as well as get estimates.</p>
<h3 id="defining-the-jags-code">Defining the JAGS Code</h3>
<p>The very first thing to implement MCMC or any Bayesian Computation in <code>rjags</code> is the specification of a JAGS code. JAGS is the acronym for <a href="http://mcmc-jags.sourceforge.net/"><strong>Just Another Gibbs Sampler</strong></a>, which is a program for simulation from Bayesian hierarchical models using Markov chain Monte Carlo (MCMC), developed by Martyn Plummer.</p>
<p>JAGS code is mainly created based on two simple operations.</p>
<ol>
<li>
<p>An assignment operator &ldquo;&lt;-&rdquo; is used to denote a deterministic relation.</p>
</li>
<li>
<p>A tilde operator &ldquo;~&rdquo; is used to denote a stochastic relation. In this case, we have a probability distribution on right hand side, according to which the left hand side variable is being generated.</p>
</li>
</ol>
<p>Based on the above operations, the following JAGS code creates the Bayesian model described above.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>model.string <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">paste0</span>(<span style="color:#e6db74">&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">             model{
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                   for(t in 2:(T_obs+1)){
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                   Km[t-1,1] &lt;- -beta*pi[t-1]*theta[t-1,1]*theta[t-1,2]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                   Km[t-1,9] &lt;- gamma*theta[t-1,2]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                   Km[t-1,5] &lt;- -Km[t-1,1]-Km[t-1,9]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                   Km[t-1,2] &lt;- -beta*pi[t-1]*(theta[t-1,1]+0.5*Km[t-1,1])*(theta[t-1,2]+0.5*Km[t-1,5])
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                   Km[t-1,10] &lt;- gamma*(theta[t-1,2]+0.5*Km[t-1,5])
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                   Km[t-1,6] &lt;- -Km[t-1,2]-Km[t-1,10]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                   Km[t-1,3] &lt;- -beta*pi[t-1]*(theta[t-1,1]+0.5*Km[t-1,2])*(theta[t-1,2]+0.5*Km[t-1,6])
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                   Km[t-1,11] &lt;- gamma*(theta[t-1,2]+0.5*Km[t-1,6])
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                   Km[t-1,7] &lt;- -Km[t-1,3]-Km[t-1,11]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                   Km[t-1,4] &lt;- -beta*pi[t-1]*(theta[t-1,1]+Km[t-1,3])*(theta[t-1,2]+Km[t-1,7])
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                   Km[t-1,12] &lt;- gamma*(theta[t-1,2]+Km[t-1,7])
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                   Km[t-1,8] &lt;- -Km[t-1,4]-Km[t-1,12]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                   alpha[t-1,1] &lt;- theta[t-1,1]+(Km[t-1,1]+2*Km[t-1,2]+2*Km[t-1,3]+Km[t-1,4])/6
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                   alpha[t-1,2] &lt;- theta[t-1,2]+(Km[t-1,5]+2*Km[t-1,6]+2*Km[t-1,7]+Km[t-1,8])/6
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                   alpha[t-1,3] &lt;- theta[t-1,3]+(Km[t-1,9]+2*Km[t-1,10]+2*Km[t-1,11]+Km[t-1,12])/6
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                   theta[t,1:3] ~ ddirch(k*alpha[t-1,1:3])
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                   I[t-1] ~ dbeta(lambdaI*theta[t,2],lambdaI*(1-theta[t,2]))
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                   R[t-1] ~ dbeta(lambdaR*theta[t,3],lambdaR*(1-theta[t,3]))
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                  }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                  theta[1,1] &lt;-  1- theta[1,2]- theta[1,3]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                  theta[1,2] ~ dbeta(&#34;</span>,<span style="color:#ae81ff">1</span>,<span style="color:#e6db74">&#34;,&#34;</span>,<span style="color:#ae81ff">1</span><span style="color:#f92672">/</span>I[1],<span style="color:#e6db74">&#34;)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                  theta[1,3] ~ dbeta(&#34;</span>,<span style="color:#ae81ff">1</span>,<span style="color:#e6db74">&#34;,&#34;</span>,<span style="color:#ae81ff">1</span><span style="color:#f92672">/</span>R[1],<span style="color:#e6db74">&#34;)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                  gamma ~  dlnorm(&#34;</span>,lognorm_gamma_param[1],<span style="color:#e6db74">&#34;,&#34;</span>,<span style="color:#ae81ff">1</span><span style="color:#f92672">/</span>lognorm_gamma_param[2],<span style="color:#e6db74">&#34;)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                  R0 ~ dlnorm(&#34;</span>,lognorm_R0_param[1],<span style="color:#e6db74">&#34;,&#34;</span>,<span style="color:#ae81ff">1</span><span style="color:#f92672">/</span>lognorm_R0_param[2],<span style="color:#e6db74">&#34;)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                  beta &lt;- R0*gamma
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                  k ~  dgamma(2,0.0001)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                  lambdaI ~ dgamma(2,0.0001)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                  lambdaR ~ dgamma(2,0.0001)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">               }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            &#34;</span>)
</span></span></code></pre></div><p>Here, <code>init.params</code> are to be passed accordingly in <code>lognorm.param</code> function to obtain the <code>lognorm_gamma_param</code> and <code>lognorm_R0_param</code> variables.</p>
<h3 id="running-the-gibbs-sampler">Running the Gibbs Sampler</h3>
<p>Now, once we have the <code>model.string</code> containing the JAGS code, we need to open a connection object to that string. Because, <code>rjags</code> expect the JAGS code to be written in a file, a connection object can gimick the behavior of a file, just based on that string. Once we have the JAGS code ready, passing the data nodes in the JAGS model helps us in creating the posterior model.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>model.spec <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">textConnection</span>(model.string)
</span></span><span style="display:flex;"><span>posterior <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">jags.model</span>(model.spec, data<span style="color:#f92672">=</span><span style="color:#a6e22e">list</span>(<span style="color:#e6db74">&#39;I&#39;</span><span style="color:#f92672">=</span>I,<span style="color:#e6db74">&#39;R&#39;</span><span style="color:#f92672">=</span>R,<span style="color:#e6db74">&#39;T_obs&#39;</span><span style="color:#f92672">=</span>T_obs,<span style="color:#e6db74">&#39;pi&#39;</span><span style="color:#f92672">=</span><span style="color:#66d9ef">pi</span>), 
</span></span><span style="display:flex;"><span>                    n.chains <span style="color:#f92672">=</span>control.params<span style="color:#f92672">$</span>nchain, n.adapt <span style="color:#f92672">=</span> control.params<span style="color:#f92672">$</span>nadapt)
</span></span></code></pre></div><p>Now, we first update the posterior for the burn-in period. In this time, the posterior generates samples are not close to the original sample, and hence we need to discard them. Typically, we set burn-in to be about $2000$ iterations. After that, we pass</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#a6e22e">update</span>(posterior, control.params<span style="color:#f92672">$</span>nburnin) <span style="color:#75715e"># update the posterior for burn in times, for this time, do not monitor anything</span>
</span></span><span style="display:flex;"><span>jags_sample <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">jags.samples</span>(posterior, <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#39;theta&#39;</span>,<span style="color:#e6db74">&#39;gamma&#39;</span>,<span style="color:#e6db74">&#39;R0&#39;</span>,<span style="color:#e6db74">&#39;beta&#39;</span>,<span style="color:#e6db74">&#39;I&#39;</span>,<span style="color:#e6db74">&#39;lambdaI&#39;</span>,<span style="color:#e6db74">&#39;lambdaR&#39;</span>,<span style="color:#e6db74">&#39;k&#39;</span>),
</span></span><span style="display:flex;"><span>                        n.iter <span style="color:#f92672">=</span> control.params<span style="color:#f92672">$</span>ndraw <span style="color:#f92672">*</span> control.params<span style="color:#f92672">$</span>nchain,
</span></span><span style="display:flex;"><span>                        thin <span style="color:#f92672">=</span> control.params<span style="color:#f92672">$</span>thin)
</span></span></code></pre></div><p>So, we combine these into a function called <code>do.MCMC</code> which we shall use later.</p>
<h2 id="forecasting-using-esir-model">Forecasting using eSIR model</h2>
<p>Now, since we have the MCMC samples obtained as the output of <code>do.MCMC</code> function, we can extend the chain using the exact simulation of the process described by the model above, and then, we can obtain the estimates of the proportion of infected and recovered people, as well as the confidence interval for that proportion.</p>
<p>Again, we shall create <code>forecast.SIR</code> function which takes in the output of <code>do.MCMC</code>, and then run the simulation chains starting from the MCMC samples. Finally, it computes the estimates and confidence intervals for the estimates of proportion of infected and removed from the samples from all the chains.</p>
<h3 id="extract-components-of-mcmc-samples">Extract components of MCMC samples</h3>
<p>Here, we extract the components of MCMC samples from the output of <code>do.MCMC</code> function.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#75715e"># extract components from mcmc samples </span>
</span></span><span style="display:flex;"><span>theta_pre <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">array</span>(<span style="color:#a6e22e">as.mcmc.list</span>(mcmc_sample<span style="color:#f92672">$</span>theta)[[1]], dim <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(control.params<span style="color:#f92672">$</span>mclen, T_obs<span style="color:#ae81ff">+1</span>, <span style="color:#ae81ff">3</span>))
</span></span><span style="display:flex;"><span>R0_pre <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">as.mcmc.list</span>(mcmc_sample<span style="color:#f92672">$</span>R0)[[1]]
</span></span><span style="display:flex;"><span>gamma_pre <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">as.mcmc.list</span>(mcmc_sample<span style="color:#f92672">$</span>gamma)[[1]]
</span></span><span style="display:flex;"><span>beta_pre <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">as.mcmc.list</span>(mcmc_sample<span style="color:#f92672">$</span>beta)[[1]]
</span></span><span style="display:flex;"><span>lambdaI_pre <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">as.mcmc.list</span>(mcmc_sample<span style="color:#f92672">$</span>lambdaI)[[1]]
</span></span><span style="display:flex;"><span>lambdaR_pre <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">as.mcmc.list</span>(mcmc_sample<span style="color:#f92672">$</span>lambdaR)[[1]]
</span></span><span style="display:flex;"><span>k_pre <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">as.mcmc.list</span>(mcmc_sample<span style="color:#f92672">$</span>k)[[1]]
</span></span></code></pre></div><p>We also initialize blank arrays to store the future forecasts. Here, <code>T_new</code> is the number of time points for which new forecasting is to be done.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>theta_post <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">array</span>(<span style="color:#ae81ff">0</span>, dim<span style="color:#f92672">=</span><span style="color:#a6e22e">c</span>(control.params<span style="color:#f92672">$</span>mclen, T_new, <span style="color:#ae81ff">3</span>))
</span></span><span style="display:flex;"><span>I_post <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">matrix</span>(<span style="color:#66d9ef">NA</span>, nrow<span style="color:#f92672">=</span>control.params<span style="color:#f92672">$</span>mclen, ncol<span style="color:#f92672">=</span>T_new)
</span></span><span style="display:flex;"><span>R_post <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">matrix</span>(<span style="color:#66d9ef">NA</span>, nrow<span style="color:#f92672">=</span>control.params<span style="color:#f92672">$</span>mclen, ncol<span style="color:#f92672">=</span>T_new)
</span></span></code></pre></div><h3 id="perform-forecasting">Perform Forecasting</h3>
<p>The following piece of code basically performs the forecasting starting from the last obtained posterior samples as obtained by MCMC. Now, let us go through the code step by step.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#66d9ef">for</span>(l <span style="color:#66d9ef">in</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span>control.params<span style="color:#f92672">$</span>mclen){
</span></span><span style="display:flex;"><span>    thetalt1 <span style="color:#f92672">&lt;-</span> theta_pre[l, T_obs<span style="color:#ae81ff">+1</span>, <span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>    thetalt2 <span style="color:#f92672">&lt;-</span> theta_pre[l, T_obs<span style="color:#ae81ff">+1</span>, <span style="color:#ae81ff">2</span>]
</span></span><span style="display:flex;"><span>    thetalt3 <span style="color:#f92672">&lt;-</span> theta_pre[l, T_obs<span style="color:#ae81ff">+1</span>, <span style="color:#ae81ff">3</span>]
</span></span><span style="display:flex;"><span>    betal <span style="color:#f92672">&lt;-</span> beta_pre[l]
</span></span><span style="display:flex;"><span>    gammal <span style="color:#f92672">&lt;-</span> gamma_pre[l]
</span></span><span style="display:flex;"><span>    kt <span style="color:#f92672">&lt;-</span> k_pre[l]
</span></span><span style="display:flex;"><span>    lambdaIl <span style="color:#f92672">&lt;-</span> lambdaI_pre[l]
</span></span><span style="display:flex;"><span>    lambdaRl <span style="color:#f92672">&lt;-</span> lambdaR_pre[l]
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (betal<span style="color:#f92672">&lt;</span><span style="color:#ae81ff">0</span> <span style="color:#f92672">|</span> gammal<span style="color:#f92672">&lt;</span><span style="color:#ae81ff">0</span> <span style="color:#f92672">|</span> thetalt1<span style="color:#f92672">&lt;</span><span style="color:#ae81ff">0</span> <span style="color:#f92672">|</span> thetalt2<span style="color:#f92672">&lt;</span><span style="color:#ae81ff">0</span> <span style="color:#f92672">|</span>thetalt3<span style="color:#f92672">&lt;</span><span style="color:#ae81ff">0</span>) { 
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">next</span> 
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span>(t <span style="color:#66d9ef">in</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span>T_new ){
</span></span><span style="display:flex;"><span>      <span style="color:#75715e"># perform runge kutta</span>
</span></span><span style="display:flex;"><span>      Km <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">numeric</span>(<span style="color:#ae81ff">12</span>)
</span></span><span style="display:flex;"><span>      alpha_post <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">numeric</span>(<span style="color:#ae81ff">3</span>)
</span></span><span style="display:flex;"><span>      Km[1] <span style="color:#f92672">&lt;-</span> <span style="color:#f92672">-</span>betal<span style="color:#f92672">*</span>pi_new[t]<span style="color:#f92672">*</span>thetalt1<span style="color:#f92672">*</span>thetalt2
</span></span><span style="display:flex;"><span>      Km[9] <span style="color:#f92672">&lt;-</span> gammal<span style="color:#f92672">*</span>thetalt2
</span></span><span style="display:flex;"><span>      Km[5] <span style="color:#f92672">&lt;-</span> <span style="color:#f92672">-</span>Km[1]<span style="color:#f92672">-</span>Km[9]
</span></span><span style="display:flex;"><span>      Km[2] <span style="color:#f92672">&lt;-</span> <span style="color:#f92672">-</span>betal<span style="color:#f92672">*</span>pi_new[t]<span style="color:#f92672">*</span>(thetalt1<span style="color:#ae81ff">+0.5</span><span style="color:#f92672">*</span>Km[1])<span style="color:#f92672">*</span>(thetalt2<span style="color:#ae81ff">+0.5</span><span style="color:#f92672">*</span>Km[5])
</span></span><span style="display:flex;"><span>      Km[10] <span style="color:#f92672">&lt;-</span> gammal<span style="color:#f92672">*</span>(thetalt2<span style="color:#ae81ff">+0.5</span><span style="color:#f92672">*</span>Km[5])
</span></span><span style="display:flex;"><span>      Km[6] <span style="color:#f92672">&lt;-</span> <span style="color:#f92672">-</span>Km[2]<span style="color:#f92672">-</span>Km[10]
</span></span><span style="display:flex;"><span>      Km[3] <span style="color:#f92672">&lt;-</span> <span style="color:#f92672">-</span>betal<span style="color:#f92672">*</span>pi_new[t]<span style="color:#f92672">*</span>(thetalt1<span style="color:#ae81ff">+0.5</span><span style="color:#f92672">*</span>Km[2])<span style="color:#f92672">*</span>(thetalt2<span style="color:#ae81ff">+0.5</span><span style="color:#f92672">*</span>Km[6])
</span></span><span style="display:flex;"><span>      Km[11] <span style="color:#f92672">&lt;-</span> gammal<span style="color:#f92672">*</span>(thetalt2<span style="color:#ae81ff">+0.5</span><span style="color:#f92672">*</span>Km[6])
</span></span><span style="display:flex;"><span>      Km[7] <span style="color:#f92672">&lt;-</span> <span style="color:#f92672">-</span>Km[3]<span style="color:#f92672">-</span>Km[11]
</span></span><span style="display:flex;"><span>      Km[4] <span style="color:#f92672">&lt;-</span> <span style="color:#f92672">-</span>betal<span style="color:#f92672">*</span>pi_new[t]<span style="color:#f92672">*</span>(thetalt1<span style="color:#f92672">+</span>Km[3])<span style="color:#f92672">*</span>(thetalt2<span style="color:#f92672">+</span>Km[7])
</span></span><span style="display:flex;"><span>      Km[12] <span style="color:#f92672">&lt;-</span> gammal<span style="color:#f92672">*</span>(thetalt2<span style="color:#f92672">+</span>Km[7])
</span></span><span style="display:flex;"><span>      Km[8] <span style="color:#f92672">&lt;-</span> <span style="color:#f92672">-</span>Km[4]<span style="color:#f92672">-</span>Km[12]
</span></span><span style="display:flex;"><span>      alpha_post[1] <span style="color:#f92672">&lt;-</span> thetalt1<span style="color:#f92672">+</span>(Km[1]<span style="color:#ae81ff">+2</span><span style="color:#f92672">*</span>Km[2]<span style="color:#ae81ff">+2</span><span style="color:#f92672">*</span>Km[3]<span style="color:#f92672">+</span>Km[4])<span style="color:#f92672">/</span><span style="color:#ae81ff">6</span>
</span></span><span style="display:flex;"><span>      alpha_post[2] <span style="color:#f92672">&lt;-</span> thetalt2<span style="color:#f92672">+</span>(Km[5]<span style="color:#ae81ff">+2</span><span style="color:#f92672">*</span>Km[6]<span style="color:#ae81ff">+2</span><span style="color:#f92672">*</span>Km[7]<span style="color:#f92672">+</span>Km[8])<span style="color:#f92672">/</span><span style="color:#ae81ff">6</span>
</span></span><span style="display:flex;"><span>      alpha_post[3] <span style="color:#f92672">&lt;-</span> thetalt3<span style="color:#f92672">+</span>(Km[9]<span style="color:#ae81ff">+2</span><span style="color:#f92672">*</span>Km[10]<span style="color:#ae81ff">+2</span><span style="color:#f92672">*</span>Km[11]<span style="color:#f92672">+</span>Km[12])<span style="color:#f92672">/</span><span style="color:#ae81ff">6</span>
</span></span><span style="display:flex;"><span>      thetalt_tmp <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">rdirichlet</span>(<span style="color:#ae81ff">1</span>, kt<span style="color:#f92672">*</span> <span style="color:#a6e22e">abs</span>(alpha_post))
</span></span><span style="display:flex;"><span>      thetalt1 <span style="color:#f92672">&lt;-</span> theta_post[l,t,<span style="color:#ae81ff">1</span>] <span style="color:#f92672">&lt;-</span> thetalt_tmp[1]
</span></span><span style="display:flex;"><span>      thetalt2 <span style="color:#f92672">&lt;-</span> theta_post[l,t,<span style="color:#ae81ff">2</span>] <span style="color:#f92672">&lt;-</span> thetalt_tmp[2]
</span></span><span style="display:flex;"><span>      thetalt3 <span style="color:#f92672">&lt;-</span> theta_post[l,t,<span style="color:#ae81ff">3</span>] <span style="color:#f92672">&lt;-</span> thetalt_tmp[3]
</span></span><span style="display:flex;"><span>      I_post[l,t] <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">rbeta</span>(<span style="color:#ae81ff">1</span>,lambdaIl<span style="color:#f92672">*</span>thetalt2,lambdaIl<span style="color:#f92672">*</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">-</span>thetalt2))
</span></span><span style="display:flex;"><span>      R_post[l,t] <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">rbeta</span>(<span style="color:#ae81ff">1</span>,lambdaRl<span style="color:#f92672">*</span>thetalt3,lambdaRl<span style="color:#f92672">*</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">-</span>thetalt3)) 
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span></code></pre></div><ol>
<li>
<p>The outer loop runs for each of the MCMC chains generated by <code>mcmc_output</code>.</p>
</li>
<li>
<p>If any of $\beta, \gamma, \theta^S,\theta^I, \theta^R$ turns out to be less than $0$, the chain is stopped and is not proceeded further.</p>
</li>
<li>
<p>In the inner loop, for each new timepoint, we perform the <a href="https://en.wikipedia.org/wiki/Runge%E2%80%93Kutta_methods">Runge Kutta methods</a> of numerically solving the differential equations,</p>
</li>
<li>
<p>At the end of the loop, we have all the estimates for proportion of Infected and Removed, as well as the three latent proportion parameters $\theta$ which accords with the underlying mathematical model of SIR.</p>
</li>
<li>
<p>Here, <code>pi_new[t] = pi[T_obs + t]</code>.</p>
</li>
</ol>
<h3 id="derivation-of-3-important-dates">Derivation of 3 important dates</h3>
<p>Associated with the estimation of eSIR model, there are three important dates, which we should output from our algorithm.</p>
<ol>
<li>
<p>The date when $\dfrac{d^2 \theta^I_t}{dt^2} = 0$. This date is the time, when the rate of change in the proportion of infected people starts to be decreasing, so we are in a hopeful scenario that the number of new infected cases is going to be decreasing over time.</p>
</li>
<li>
<p>The date when $\dfrac{d \theta^I_t}{dt} = 0$, i.e. the date from when the number of new recovered cases starts to exceed the number of new infected cases. From this time onwards, the epidemic nature of the disease vanishes.</p>
</li>
<li>
<p>The date when $\theta^I_t = 0$. However, it is impossible to have this proportion equal to $0$, in finite times. Therefore, we shall be looking for a date, when $\theta^I_t &lt; \epsilon$, where $\epsilon$ is a very small quantity, which can be treated readily at any time.</p>
</li>
</ol>
<p>To simplify the calculation of derivative, we track the quantity $(\beta \pi(t) \theta^S_t\theta^I_t - \gamma \theta^I_t)$ over time, which is equal to the derivative due to SIR modelling.</p>
<p>The following picture taken from the <a href="https://www.medrxiv.org/content/10.1101/2020.02.29.20029421v1.full.pdf">paper</a> by Wang et al. shows the concept clearly.</p>
<img 
    class='max-w-full mx-4 md:mx-auto rounded-lg h-auto shadow-md' 
    src='deriv.png'>
</img>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>theta_diff_pre <span style="color:#f92672">&lt;-</span> theta_pre[, <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span>T_obs, <span style="color:#ae81ff">2</span>] <span style="color:#f92672">*</span> <span style="color:#a6e22e">sweep</span>(beta_pre <span style="color:#f92672">%*%</span> <span style="color:#a6e22e">t</span>(<span style="color:#66d9ef">pi</span>[1<span style="color:#f92672">:</span>T_obs]) <span style="color:#f92672">*</span> theta_pre[, <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span>T_obs, <span style="color:#ae81ff">1</span>], MARGIN <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>, STATS <span style="color:#f92672">=</span> gamma_pre)
</span></span><span style="display:flex;"><span>theta_diff_post <span style="color:#f92672">&lt;-</span> theta_post[, , <span style="color:#ae81ff">2</span>] <span style="color:#f92672">*</span> <span style="color:#a6e22e">sweep</span>(beta_pre <span style="color:#f92672">%*%</span> <span style="color:#a6e22e">t</span>(<span style="color:#66d9ef">pi</span><span style="color:#a6e22e">[</span>(T_obs<span style="color:#ae81ff">+1</span>)<span style="color:#f92672">:</span>(T_obs<span style="color:#f92672">+</span>T_new)]) <span style="color:#f92672">*</span> theta_post[, , <span style="color:#ae81ff">1</span>], MARGIN <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>, STATS <span style="color:#f92672">=</span> gamma_pre)
</span></span><span style="display:flex;"><span>theta_diff <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">cbind</span>(theta_diff_pre, theta_diff_post)
</span></span></code></pre></div><p>Now, we find the maximum of each row of <code>theta_diff</code> and locate the timepoints, where <code>theta_diff</code> is changing its signs. They should give up the required first and second important dates.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>first_dates <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">apply</span>(theta_diff, <span style="color:#ae81ff">1</span>, which.max)
</span></span><span style="display:flex;"><span>second_dates <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">apply</span>(theta_diff, <span style="color:#ae81ff">1</span>, <span style="color:#66d9ef">function</span>(x) { <span style="color:#a6e22e">length</span>(x) <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">-</span> <span style="color:#a6e22e">which</span>(<span style="color:#a6e22e">cumprod</span>(<span style="color:#a6e22e">rev</span>(x <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">0</span>)) <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>)[1] } )    <span style="color:#75715e"># the first time it becomes negative and stays negative throughout</span>
</span></span></code></pre></div><p>Now, that we have the dates for each chain, let us take the mean, median, and quantiles, which would give us estimates and confidence intervals for such dates.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>conf.quant <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">c</span>(conf.level<span style="color:#f92672">/</span><span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">0.5</span>, <span style="color:#ae81ff">1</span><span style="color:#f92672">-</span>conf.level<span style="color:#f92672">/</span><span style="color:#ae81ff">2</span>)    <span style="color:#75715e"># conf.level is the confidence coefficients for the confidence interval</span>
</span></span><span style="display:flex;"><span>first_date_summary <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">c</span>( <span style="color:#a6e22e">mean</span>(first_dates, na.rm <span style="color:#f92672">=</span> T), <span style="color:#a6e22e">quantile</span>(first_dates, probs <span style="color:#f92672">=</span> conf.quant, na.rm <span style="color:#f92672">=</span> T) )
</span></span><span style="display:flex;"><span>second_date_summary <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">c</span>( <span style="color:#a6e22e">mean</span>(second_dates, na.rm <span style="color:#f92672">=</span> T), <span style="color:#a6e22e">quantile</span>(second_dates, probs <span style="color:#f92672">=</span> conf.quant, na.rm <span style="color:#f92672">=</span> T) )
</span></span></code></pre></div><h3 id="summarising-the-forecast-outputs">Summarising the forecast outputs</h3>
<p>Once we have perform forecasting for each and every chain of the MCMC samples, we can aggregated them to obtain the mean, median, and quantiles, which would give us estimates for the proportion of people in state infected and removed, as well as the confidence interval for those estimates.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#75715e"># till the observed time points</span>
</span></span><span style="display:flex;"><span>thetaI_band <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">t</span>(<span style="color:#a6e22e">apply</span>(theta_pre[,<span style="color:#ae81ff">-1</span>,<span style="color:#ae81ff">2</span>] , <span style="color:#ae81ff">2</span>, quantile, probs<span style="color:#f92672">=</span>conf.quant, na.rm<span style="color:#f92672">=</span>T))   
</span></span><span style="display:flex;"><span>thetaR_band<span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">t</span>(<span style="color:#a6e22e">apply</span>(theta_pre[,<span style="color:#ae81ff">-1</span>,<span style="color:#ae81ff">3</span>] , <span style="color:#ae81ff">2</span>, quantile, probs<span style="color:#f92672">=</span>conf.quant, na.rm<span style="color:#f92672">=</span>T))
</span></span><span style="display:flex;"><span>thetaI_mean <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">colMeans</span>(theta_pre[, <span style="color:#ae81ff">-1</span>, <span style="color:#ae81ff">2</span>], na.rm <span style="color:#f92672">=</span> T)
</span></span><span style="display:flex;"><span>thetaR_mean <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">colMeans</span>(theta_pre[, <span style="color:#ae81ff">-1</span>, <span style="color:#ae81ff">3</span>], na.rm <span style="color:#f92672">=</span> T)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># for the new time points</span>
</span></span><span style="display:flex;"><span>YI_band <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">t</span>(<span style="color:#a6e22e">apply</span>(I_post , <span style="color:#ae81ff">2</span>, quantile, probs<span style="color:#f92672">=</span>conf.quant, na.rm<span style="color:#f92672">=</span>T))   
</span></span><span style="display:flex;"><span>YR_band<span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">t</span>(<span style="color:#a6e22e">apply</span>(R_post , <span style="color:#ae81ff">2</span>, quantile, probs<span style="color:#f92672">=</span>conf.quant, na.rm<span style="color:#f92672">=</span>T))
</span></span><span style="display:flex;"><span>YI_mean <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">colMeans</span>(I_post, na.rm <span style="color:#f92672">=</span> T)
</span></span><span style="display:flex;"><span>YR_mean <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">colMeans</span>(R_post, na.rm <span style="color:#f92672">=</span> T)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># combine into a data frame</span>
</span></span><span style="display:flex;"><span>infected.dat <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">data.frame</span>( <span style="color:#a6e22e">rbind</span>( <span style="color:#a6e22e">cbind</span>(thetaI_mean, thetaI_band, <span style="color:#a6e22e">rep</span>(<span style="color:#e6db74">&#34;pre&#34;</span>, T_obs) ), <span style="color:#a6e22e">cbind</span>(YI_mean, YI_band, <span style="color:#a6e22e">rep</span>(<span style="color:#e6db74">&#34;post&#34;</span>, T_new) ) ) )
</span></span><span style="display:flex;"><span>removed.dat <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">data.frame</span>( <span style="color:#a6e22e">rbind</span>( <span style="color:#a6e22e">cbind</span>(thetaR_mean, thetaR_band, <span style="color:#a6e22e">rep</span>(<span style="color:#e6db74">&#34;pre&#34;</span>, T_obs) ), <span style="color:#a6e22e">cbind</span>(YR_mean, YR_band, <span style="color:#a6e22e">rep</span>(<span style="color:#e6db74">&#34;post&#34;</span>, T_new) ) ) )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">colnames</span>(infected.dat) <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;mean&#34;</span>, <span style="color:#e6db74">&#34;lower&#34;</span>, <span style="color:#e6db74">&#34;median&#34;</span>, <span style="color:#e6db74">&#34;upper&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">colnames</span>(removed.dat) <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;mean&#34;</span>, <span style="color:#e6db74">&#34;lower&#34;</span>, <span style="color:#e6db74">&#34;median&#34;</span>, <span style="color:#e6db74">&#34;upper&#34;</span>)
</span></span></code></pre></div><p>Then, we can return a list comprising of these two datasets, as well as the summary corresponding to the first and second date obtained earlier. This whole piece of code, is compressed into a function called <code>forecast.SIR</code>, which we shall call later.</p>
<h1 id="checking-performance-of-esir">Checking Performance of eSIR</h1>
<p>Now, we shall be using the data for <code>Italy</code>, in order to figure out how our <code>eSIR</code> model performs for this data.</p>
<h2 id="performance-for-italy">Performance for Italy</h2>
<p>According to <a href="https://www.worldometers.info/world-population/italy-population/">Worldometers</a> sources, the projected population for Italy is about 6 crores. Based on that, we compute the observed proportion of the infected and removed (including deaths and recovered), and fit the eSIR model. The following code calls the <code>do.MCMC</code> function and performs the MCMC fitting. Here, we use 4 weeks of data, of the available 5 weeks of data, and we shall try to forecast for the last week, to see how the model performed.</p>
<p>Also, the $\pi(t)$ function choosen for Italy is as follows;</p>
<p>$$\pi(t) = \begin{cases}
1 &amp; \text{ if } t &lt; \text{4th March, 2020}\\\
0.25 &amp; \text{ if } t &gt; \text{9th March, 2020}\\\
0.5 &amp; \text{ otherwise }\\\
\end{cases}$$</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>subdat <span style="color:#f92672">&lt;-</span> dat <span style="color:#f92672">%&gt;%</span> <span style="color:#a6e22e">mutate</span>(Removed <span style="color:#f92672">=</span> Deaths <span style="color:#f92672">+</span> Recovered) <span style="color:#f92672">%&gt;%</span> <span style="color:#a6e22e">filter</span>(Country <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;Italy&#34;</span> <span style="color:#f92672">&amp;</span> Removed <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>N <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">60550075</span>
</span></span><span style="display:flex;"><span>R <span style="color:#f92672">&lt;-</span> subdat<span style="color:#f92672">$</span>Removed <span style="color:#f92672">/</span> N
</span></span><span style="display:flex;"><span>I <span style="color:#f92672">&lt;-</span> subdat<span style="color:#f92672">$</span>Confirmed<span style="color:#f92672">/</span>N <span style="color:#f92672">-</span> R
</span></span><span style="display:flex;"><span>pi0 <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">ifelse</span>(subdat<span style="color:#f92672">$</span>Date <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">as.Date</span>(<span style="color:#e6db74">&#39;2020-03-04&#39;</span>), <span style="color:#ae81ff">1</span>, 
</span></span><span style="display:flex;"><span>              <span style="color:#a6e22e">ifelse</span>(subdat<span style="color:#f92672">$</span>Date <span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">as.Date</span>(<span style="color:#e6db74">&#39;2020-03-09&#39;</span>), <span style="color:#ae81ff">0.25</span>, <span style="color:#ae81ff">0.5</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>init.params <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">list</span>(R0 <span style="color:#f92672">=</span> <span style="color:#ae81ff">3.15</span>, R0_sd <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>, gamma0 <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.0117</span>, gamma0_sd <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.1</span>)
</span></span><span style="display:flex;"><span>control.params <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">list</span>(nchain<span style="color:#f92672">=</span><span style="color:#ae81ff">4</span>, nadapt<span style="color:#f92672">=</span><span style="color:#ae81ff">1e4</span>, ndraw<span style="color:#f92672">=</span><span style="color:#ae81ff">5e2</span>, thin<span style="color:#f92672">=</span><span style="color:#ae81ff">10</span>, nburnin<span style="color:#f92672">=</span><span style="color:#ae81ff">2e2</span>)
</span></span><span style="display:flex;"><span>control.params<span style="color:#f92672">$</span>mclen <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">round</span>(control.params<span style="color:#f92672">$</span>ndraw <span style="color:#f92672">/</span> control.params<span style="color:#f92672">$</span>thin) <span style="color:#f92672">*</span> control.params<span style="color:#f92672">$</span>nchain 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>mcmc_samples <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">do.MCMC</span>(I[1<span style="color:#f92672">:</span><span style="color:#ae81ff">28</span>], R[1<span style="color:#f92672">:</span><span style="color:#ae81ff">28</span>], pi0[1<span style="color:#f92672">:</span><span style="color:#ae81ff">28</span>], init.params, control.params)
</span></span></code></pre></div><p>You should see something like this, which tells you that the JAGS code for MCMC is running properly.</p>
<pre tabindex="0"><code>Compiling model graph
   Resolving undeclared variables
   Allocating nodes
Graph information:
   Observed stochastic nodes: 56
   Unobserved stochastic nodes: 35
   Total graph size: 1591
<p>Initializing model
</code></pre><p>As we see from the following plot, the predictions for the last week is underestimating the true proportions. However, the observed proportions lie within the bound of $95%$ confidence band.</p></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>preds <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">forecast.SIR</span>(<span style="color:#ae81ff">7</span>, <span style="color:#ae81ff">28</span>, mcmc_samples, <span style="color:#66d9ef">pi</span> <span style="color:#f92672">=</span> pi0, control.params <span style="color:#f92672">=</span> control.params, start.date <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;2020-02-21&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">ggplot</span>(preds<span style="color:#f92672">$</span>infected, <span style="color:#a6e22e">aes</span>(x <span style="color:#f92672">=</span> date)) <span style="color:#f92672">+</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">geom_ribbon</span>(<span style="color:#a6e22e">aes</span>(ymin <span style="color:#f92672">=</span> lower, ymax <span style="color:#f92672">=</span> upper, fill <span style="color:#f92672">=</span> phase), alpha <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.25</span>) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">geom_line</span>(<span style="color:#a6e22e">aes</span>(y <span style="color:#f92672">=</span> mean, color <span style="color:#f92672">=</span> phase), size <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">labs</span>(x <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Date&#34;</span>, y <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;P(Infected)&#34;</span>) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">geom_point</span>(data <span style="color:#f92672">=</span> subdat, <span style="color:#a6e22e">aes</span>(x <span style="color:#f92672">=</span> Date, y <span style="color:#f92672">=</span> (Confirmed <span style="color:#f92672">-</span> Removed)<span style="color:#f92672">/</span>N), color <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;black&#34;</span>)
</span></span></code></pre></div><img 
    class='max-w-md mx-4 md:mx-auto rounded-lg h-auto shadow-md' 
    src='unnamed-chunk-20-1.png'>
</img>
<p>However, if we assume that, the Italy government maintains the current lockdown indefinitely, then $\pi(t) = 0.25$ will continue to remain. In such case, the important dates (as mentioned above) for change in the rate of newly infected can be obtained, as shown in the following plot.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>pi0 <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">c</span>(pi0, <span style="color:#a6e22e">rep</span>(<span style="color:#ae81ff">0.25</span>, <span style="color:#ae81ff">200</span>))
</span></span><span style="display:flex;"><span>preds <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">forecast.SIR</span>(<span style="color:#ae81ff">7+200</span>, <span style="color:#ae81ff">28</span>, mcmc_samples, <span style="color:#66d9ef">pi</span> <span style="color:#f92672">=</span> pi0, control.params <span style="color:#f92672">=</span> control.params, start.date <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;2020-02-21&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">ggplot</span>(preds<span style="color:#f92672">$</span>infected, <span style="color:#a6e22e">aes</span>(x <span style="color:#f92672">=</span> date)) <span style="color:#f92672">+</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">geom_ribbon</span>(<span style="color:#a6e22e">aes</span>(ymin <span style="color:#f92672">=</span> lower, ymax <span style="color:#f92672">=</span> upper, fill <span style="color:#f92672">=</span> phase), alpha <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.25</span>) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">geom_line</span>(<span style="color:#a6e22e">aes</span>(y <span style="color:#f92672">=</span> mean, color <span style="color:#f92672">=</span> phase), size <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">geom_vline</span>(xintercept <span style="color:#f92672">=</span> preds<span style="color:#f92672">$</span>first.date[1], color <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;brown&#34;</span>) <span style="color:#f92672">+</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">geom_vline</span>(xintercept <span style="color:#f92672">=</span> preds<span style="color:#f92672">$</span>second.date[1], color <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;blue4&#34;</span>) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">labs</span>(x <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Date&#34;</span>, y <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;P(Infected)&#34;</span>) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">geom_point</span>(data <span style="color:#f92672">=</span> subdat, <span style="color:#a6e22e">aes</span>(x <span style="color:#f92672">=</span> Date, y <span style="color:#f92672">=</span> (Confirmed <span style="color:#f92672">-</span> Removed)<span style="color:#f92672">/</span>N), color <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;black&#34;</span>) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">geom_text</span>(x <span style="color:#f92672">=</span> preds<span style="color:#f92672">$</span>first.date[1] <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>, y <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, label <span style="color:#f92672">=</span> <span style="color:#a6e22e">format</span>(preds<span style="color:#f92672">$</span>first.date[1], <span style="color:#e6db74">&#34;%b %d&#34;</span>), size <span style="color:#f92672">=</span> <span style="color:#ae81ff">4</span> ) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">geom_text</span>(x <span style="color:#f92672">=</span> preds<span style="color:#f92672">$</span>second.date[1] <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>, y <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, label <span style="color:#f92672">=</span> <span style="color:#a6e22e">format</span>(preds<span style="color:#f92672">$</span>second.date[1], <span style="color:#e6db74">&#34;%b %d&#34;</span>), size <span style="color:#f92672">=</span> <span style="color:#ae81ff">4</span> )
</span></span></code></pre></div><img 
    class='max-w-md mx-4 md:mx-auto rounded-lg h-auto shadow-md' 
    src='plot2.jpeg'>
</img>
<p>Therefore, in Italy, at about June 24, we should see decreasing increments of newly infected persons, and from August 17 onwards, the proportion of infected people should start to decline.</p>
<h2 id="estimation-for-india">Estimation for India</h2>
<p>However, our main concern is to find out the situation of India based on this eSIR modelling. Here, we shall use the $\pi(t)$ function as follows, as per various decision taken by the Government, like restriction on international flights, Janta Curfew and full scale lockdowns etc.</p>
<p>$$\pi(t) = \begin{cases}
1 &amp; \text{ if } t &lt; \text{15th March, 2020}\\\
0.95 &amp; \text{ if } \text{15th March, 2020} &lt; t &lt; \text{19th March, 2020}\\\
0.9 &amp; \text{ if } \text{19th March, 2020} &lt; t &lt; \text{22th March, 2020}\\\
0.5 &amp; \text{ if } \text{22th March, 2020} &lt; t &lt; \text{25th March, 2020}\\\
0.1 &amp; \text{ if } t &gt; \text{25th March, 2020}\\\
\end{cases}$$</p>
<p>Also, note that in India, many places are rural in nature, while most of the urban population and neighbourhood areas are more susceptible to get the disease than others, due to availablity of metro cities and international airports. So, rather than using the whole population size i.e. $131$ crores as $N$, we shall use about $350$ lakhs as the adjusted population size.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>subdat <span style="color:#f92672">&lt;-</span> dat <span style="color:#f92672">%&gt;%</span> <span style="color:#a6e22e">mutate</span>(Removed <span style="color:#f92672">=</span> Deaths <span style="color:#f92672">+</span> Recovered, Infected <span style="color:#f92672">=</span> Confirmed <span style="color:#f92672">-</span> Removed) <span style="color:#f92672">%&gt;%</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">filter</span>(Country <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;India&#34;</span> <span style="color:#f92672">&amp;</span> Removed <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">&amp;</span> Infected <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>N <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">350e5</span>   <span style="color:#75715e"># adjusted population for metro cities and neighbourhood areas</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>R <span style="color:#f92672">&lt;-</span> subdat<span style="color:#f92672">$</span>Removed <span style="color:#f92672">/</span> N
</span></span><span style="display:flex;"><span>I <span style="color:#f92672">&lt;-</span> subdat<span style="color:#f92672">$</span>Infected<span style="color:#f92672">/</span>N
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>pi0 <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">ifelse</span>(subdat<span style="color:#f92672">$</span>Date <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">as.Date</span>(<span style="color:#e6db74">&#39;2020-03-15&#39;</span>), <span style="color:#ae81ff">1</span>, 
</span></span><span style="display:flex;"><span>              <span style="color:#a6e22e">ifelse</span>(subdat<span style="color:#f92672">$</span>Date <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">as.Date</span>(<span style="color:#e6db74">&#39;2020-03-19&#39;</span>), <span style="color:#ae81ff">0.9</span>, 
</span></span><span style="display:flex;"><span>                     <span style="color:#a6e22e">ifelse</span>(subdat<span style="color:#f92672">$</span>Date <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">as.Date</span>(<span style="color:#e6db74">&#39;2020-03-22&#39;</span>), <span style="color:#ae81ff">0.8</span>, 
</span></span><span style="display:flex;"><span>                            <span style="color:#a6e22e">ifelse</span>(subdat<span style="color:#f92672">$</span>Date <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">as.Date</span>(<span style="color:#e6db74">&#39;2020-03-25&#39;</span>), <span style="color:#ae81ff">0.5</span>, <span style="color:#ae81ff">0.1</span>)) ))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>init.params <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">list</span>(R0 <span style="color:#f92672">=</span> <span style="color:#ae81ff">12.48</span>, R0_sd <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>, gamma0 <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.117</span>, gamma0_sd <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>control.params <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">list</span>(nchain<span style="color:#f92672">=</span><span style="color:#ae81ff">4</span>, nadapt<span style="color:#f92672">=</span><span style="color:#ae81ff">1e4</span>, ndraw<span style="color:#f92672">=</span><span style="color:#ae81ff">5e2</span>, thin<span style="color:#f92672">=</span><span style="color:#ae81ff">5</span>, nburnin<span style="color:#f92672">=</span><span style="color:#ae81ff">2e2</span>)
</span></span><span style="display:flex;"><span>control.params<span style="color:#f92672">$</span>mclen <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">round</span>(control.params<span style="color:#f92672">$</span>ndraw <span style="color:#f92672">/</span> control.params<span style="color:#f92672">$</span>thin) <span style="color:#f92672">*</span> control.params<span style="color:#f92672">$</span>nchain 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>mcmc_samples <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">do.MCMC</span>(I, R, pi0, init.params, control.params)
</span></span></code></pre></div><p>And finally, we perform the prediction till the end of the lockdown, i.e. till $14$-th April, to see the effect of quarantining.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>pi1 <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">c</span>(pi0, <span style="color:#a6e22e">rep</span>(<span style="color:#ae81ff">0.1</span>, <span style="color:#ae81ff">19</span>))   <span style="color:#75715e"># from 27th March, it is 19 days of lockdown left </span>
</span></span><span style="display:flex;"><span>preds <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">forecast.SIR</span>(<span style="color:#ae81ff">19</span>, <span style="color:#ae81ff">25</span>, mcmc_samples, <span style="color:#66d9ef">pi</span> <span style="color:#f92672">=</span> pi1, control.params <span style="color:#f92672">=</span> control.params, start.date <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;2020-03-02&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">ggplot</span>(preds<span style="color:#f92672">$</span>infected, <span style="color:#a6e22e">aes</span>(x <span style="color:#f92672">=</span> date)) <span style="color:#f92672">+</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">geom_ribbon</span>(<span style="color:#a6e22e">aes</span>(ymin <span style="color:#f92672">=</span> lower, ymax <span style="color:#f92672">=</span> upper, fill <span style="color:#f92672">=</span> phase), alpha <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.25</span>) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">geom_line</span>(<span style="color:#a6e22e">aes</span>(y <span style="color:#f92672">=</span> mean, color <span style="color:#f92672">=</span> phase), size <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">labs</span>(x <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Date&#34;</span>, y <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;P(Infected)&#34;</span>) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">geom_point</span>(data <span style="color:#f92672">=</span> subdat, <span style="color:#a6e22e">aes</span>(x <span style="color:#f92672">=</span> Date, y <span style="color:#f92672">=</span> Infected<span style="color:#f92672">/</span>N), color <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;black&#34;</span>)
</span></span></code></pre></div><img 
    class='max-w-md mx-4 md:mx-auto rounded-lg h-auto shadow-md' 
    src='unnamed-chunk-23-1.png'>
</img>
<p>Although it seems that the mean proportion is overestimated during the ovserved period, however the effect of quanting seems to work to a moderate extent, as the estimated proportion stays more or less at the same level. The exact count of the infected people at the end of lockdown, provided that it is maintained properly, should be about $1571$ many infected persons, and about $2114$ confirmed cases of COVID-19.</p>
<p>Similar to Italy, if we extend its forecast for some more days, and keep the same level of quarantining, the model predictions are given in the following plot.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>pi2 <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">c</span>(pi0, <span style="color:#a6e22e">rep</span>(<span style="color:#ae81ff">0.1</span>, <span style="color:#ae81ff">200</span>)) 
</span></span><span style="display:flex;"><span>preds <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">forecast.SIR</span>(<span style="color:#ae81ff">200</span>, <span style="color:#ae81ff">25</span>, mcmc_samples, <span style="color:#66d9ef">pi</span> <span style="color:#f92672">=</span> pi2, control.params <span style="color:#f92672">=</span> control.params, start.date <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;2020-03-02&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">ggplot</span>(preds<span style="color:#f92672">$</span>infected, <span style="color:#a6e22e">aes</span>(x <span style="color:#f92672">=</span> date)) <span style="color:#f92672">+</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">geom_ribbon</span>(<span style="color:#a6e22e">aes</span>(ymin <span style="color:#f92672">=</span> lower, ymax <span style="color:#f92672">=</span> upper, fill <span style="color:#f92672">=</span> phase), alpha <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.25</span>) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">geom_line</span>(<span style="color:#a6e22e">aes</span>(y <span style="color:#f92672">=</span> mean, color <span style="color:#f92672">=</span> phase), size <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">geom_vline</span>(xintercept <span style="color:#f92672">=</span> preds<span style="color:#f92672">$</span>first.date[1], color <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;brown&#34;</span>, size <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>, linetype <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;dashed&#34;</span>) <span style="color:#f92672">+</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">geom_vline</span>(xintercept <span style="color:#f92672">=</span> preds<span style="color:#f92672">$</span>second.date[1], color <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;blue4&#34;</span>, size <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>, linetype <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;dashed&#34;</span>) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">labs</span>(x <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Date&#34;</span>, y <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;P(Infected)&#34;</span>) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">geom_point</span>(data <span style="color:#f92672">=</span> subdat, <span style="color:#a6e22e">aes</span>(x <span style="color:#f92672">=</span> Date, y <span style="color:#f92672">=</span> (Confirmed <span style="color:#f92672">-</span> Removed)<span style="color:#f92672">/</span>N), color <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;black&#34;</span>) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">geom_text</span>(x <span style="color:#f92672">=</span> preds<span style="color:#f92672">$</span>first.date[1] <span style="color:#f92672">-</span> <span style="color:#ae81ff">7</span>, y <span style="color:#f92672">=</span> <span style="color:#ae81ff">2e-4</span>, label <span style="color:#f92672">=</span> <span style="color:#a6e22e">format</span>(preds<span style="color:#f92672">$</span>first.date[1], <span style="color:#e6db74">&#34;%b %d&#34;</span>), size <span style="color:#f92672">=</span> <span style="color:#ae81ff">4</span> ) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">geom_text</span>(x <span style="color:#f92672">=</span> preds<span style="color:#f92672">$</span>second.date[1] <span style="color:#f92672">+</span> <span style="color:#ae81ff">7</span>, y <span style="color:#f92672">=</span> <span style="color:#ae81ff">3e-4</span>, label <span style="color:#f92672">=</span> <span style="color:#a6e22e">format</span>(preds<span style="color:#f92672">$</span>second.date[1], <span style="color:#e6db74">&#34;%b %d&#34;</span>), size <span style="color:#f92672">=</span> <span style="color:#ae81ff">4</span> )
</span></span></code></pre></div><img 
    class='max-w-md mx-4 md:mx-auto rounded-lg h-auto shadow-md' 
    src='unnamed-chunk-25-1.png'>
</img>
<p>Therefore, as it seems, if we keep the lockdown (as it is now), based on the data, it might take till October to have the proportion of infected people becoming insignificant, provided we keep the same level of quanranting effect. However, from March 17, we should see a decrease in the rate of increment in the number of infected, and from March 29 onwards, we should be at a position from where the number of newly infected persons per day starts to decrease gradually.</p>
<p>Since, it is very economically and physically dissatisfying to be in a lockdown (or state of home quarantine till October, where Durga Puja festival is going to occur), we might want to go outside. In that case, assuming $\pi(t)$ increases to $0.5$, which is indeed less than 1, due to our increasing awareness of the scenario, then, the predicted situation would look like this.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>pi3 <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">c</span>(pi0, <span style="color:#a6e22e">rep</span>(<span style="color:#ae81ff">0.1</span>, <span style="color:#ae81ff">19</span>), <span style="color:#a6e22e">rep</span>(<span style="color:#ae81ff">0.5</span>, <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">365</span>)) 
</span></span><span style="display:flex;"><span>preds <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">forecast.SIR</span>(<span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">365</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">19</span>, <span style="color:#ae81ff">25</span>, mcmc_samples, <span style="color:#66d9ef">pi</span> <span style="color:#f92672">=</span> pi3, control.params <span style="color:#f92672">=</span> control.params, start.date <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;2020-03-02&#34;</span>)
</span></span><span style="display:flex;"><span>preds<span style="color:#f92672">$</span>infected<span style="color:#f92672">$</span>upper_new <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">pmin</span>(preds<span style="color:#f92672">$</span>infected<span style="color:#f92672">$</span>upper, <span style="color:#ae81ff">0.05</span>)   <span style="color:#75715e"># just for visual purpose</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">ggplot</span>(preds<span style="color:#f92672">$</span>infected, <span style="color:#a6e22e">aes</span>(x <span style="color:#f92672">=</span> date)) <span style="color:#f92672">+</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">geom_ribbon</span>(<span style="color:#a6e22e">aes</span>(ymin <span style="color:#f92672">=</span> lower, ymax <span style="color:#f92672">=</span> upper_new, fill <span style="color:#f92672">=</span> phase), alpha <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.25</span>) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">geom_line</span>(<span style="color:#a6e22e">aes</span>(y <span style="color:#f92672">=</span> mean, color <span style="color:#f92672">=</span> phase), size <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">geom_vline</span>(xintercept <span style="color:#f92672">=</span> preds<span style="color:#f92672">$</span>first.date[1], color <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;brown&#34;</span>, size <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>, linetype <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;dashed&#34;</span>) <span style="color:#f92672">+</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">geom_vline</span>(xintercept <span style="color:#f92672">=</span> preds<span style="color:#f92672">$</span>second.date[1], color <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;blue4&#34;</span>, size <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>, linetype <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;dashed&#34;</span>) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">labs</span>(x <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Date&#34;</span>, y <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;P(Infected)&#34;</span>) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">geom_point</span>(data <span style="color:#f92672">=</span> subdat, <span style="color:#a6e22e">aes</span>(x <span style="color:#f92672">=</span> Date, y <span style="color:#f92672">=</span> (Confirmed <span style="color:#f92672">-</span> Removed)<span style="color:#f92672">/</span>N), color <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;black&#34;</span>) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">geom_text</span>(x <span style="color:#f92672">=</span> preds<span style="color:#f92672">$</span>first.date[1] <span style="color:#f92672">-</span> <span style="color:#ae81ff">7</span>, y <span style="color:#f92672">=</span> <span style="color:#ae81ff">2e-4</span>, label <span style="color:#f92672">=</span> <span style="color:#a6e22e">format</span>(preds<span style="color:#f92672">$</span>first.date[1], <span style="color:#e6db74">&#34;%b %d&#34;</span>), size <span style="color:#f92672">=</span> <span style="color:#ae81ff">4</span> ) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">geom_text</span>(x <span style="color:#f92672">=</span> preds<span style="color:#f92672">$</span>second.date[1] <span style="color:#f92672">+</span> <span style="color:#ae81ff">7</span>, y <span style="color:#f92672">=</span> <span style="color:#ae81ff">3e-4</span>, label <span style="color:#f92672">=</span> <span style="color:#a6e22e">format</span>(preds<span style="color:#f92672">$</span>second.date[1], <span style="color:#e6db74">&#34;%b %d&#34;</span>), size <span style="color:#f92672">=</span> <span style="color:#ae81ff">4</span> )
</span></span></code></pre></div><img 
    class='max-w-md mx-4 md:mx-auto rounded-lg h-auto shadow-md' 
    src='plot5.jpeg'>
</img>
<p>This scenario would be very severe for us, since it would affect about $6%$ of the urban population on about June 27, and then it would start to decrease gradually. However, it would take almost 2 years, to make this epidemic insignificant, provided there would be no generally accepted antiviral medicine for COVID-19 till then.</p>
<p>Hence, we must avoid such situation at all costs, and to counter it, we must stay home, at a shelter in place home quarantining atmosphere.</p>
<h1 id="conclusion">Conclusion</h1>
<p>This <strong>eSIR model is not perfect.</strong> No statistical model is. But the main idea and examples that we are seeing currently all over the world, should give us a hint about what is to come.</p>
<p>There are several backdrops in <strong>eSIR</strong> model.</p>
<ol>
<li>
<p>It does not talk about underreporting. When you are in a place like India, underreporting is a major issue, as there might be some people who are affected by coronavirus, but lightly takes their symptoms as seasonal cold.</p>
</li>
<li>
<p>In the basis of SIR model, we assume the existence of only 3 states. To incorporate the effect of quarantining, we only considering the people in Infected state. However, there might be people who are infected, and can spread the disease, yet they do not have the symptoms, and hence does not fall under the effect of quarantining.</p>
</li>
</ol>
<p><strong>WHO Guidelines to STAY SAFE:</strong></p>
<ul>
<li>
<p>The best way to prevent and slow down transmission is be well informed about the COVID-19 virus, the disease it causes and how it spreads.</p>
</li>
<li>
<p>Wash your hands frequently with an alcohol based rub or soap.</p>
</li>
<li>
<p>Maintain social distancing.</p>
</li>
<li>
<p>Avoid touching eyes, nose and mouth.</p>
</li>
<li>
<p>Practice respiratory hygiene.</p>
</li>
<li>
<p>If you have fever, cough and difficulty breathing, seek medical care early.</p>
</li>
<li>
<p>Stay informed and follow advice given by your healthcare provider.</p>
</li>
<li>
<p>Protect yourselves and protect others.</p>
</li>
</ul>

                </div>
            </div>
        </div>
    </div>
    <div class="flex flex-row justify-center items-center mb-3">
        <h2 class="text-lg text-blue-600">
            With heartfelt appreciation, thank you for being a valued reader, until next time!
        </h2>
    </div>
</div>



<div class="my-6 max-w-6xl md:mx-auto mx-4 text-center shadow-md rounded-md p-4">
    <p class="italic text-lg font-semibold my-4">Explore more posts like this</p>
    <div class="flex flex-row justify-center gap-4">
        
            <a href="//localhost:1313/posts/2020/covid19-sir-model/" 
                class="px-6 py-2 bg-blue-800 text-white hover:bg-neutral-900 focus:bg-neutral-900 
                    transition-all ease-in-out rounded-md shadow-sm">
                Previous Post
            </a>
        
        
            <a href="//localhost:1313/posts/2021/texture-network-style-transfer/" class="px-6 py-2 bg-blue-800 text-white hover:bg-neutral-900
             focus:bg-neutral-900 transition-all ease-in-out rounded-md shadow-sm">
                Next Post
            </a>
        
    </div>
    <div class="flex flex-row justify-center gap-4 my-4">
        <a href="//localhost:1313/posts/" 
            class="px-6 py-2 bg-blue-800 text-white hover:bg-neutral-900 focus:bg-neutral-900 
                transition-all ease-in-out rounded-md shadow-sm">
            See all posts
        </a>
    </div>
</div>


<div class="my-6 max-w-6xl md:mx-auto mx-4">
    <div id="disqus_thread"></div>
<script>
    window.disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "statwizard" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>



        </div>

        
<section
  id="contact-me"
  class="py-8 mt-16 w-full bg-gradient-to-r from-neutral-900 to-black"
>
  <div class="max-w-6xl mx-auto my-8 text-white text-center">
    <p class="font-normal text-2xl py-4">Reach out to me via</p>
    
    <div class="hidden">
      <div class="hover:bg-red-500 focus:bg-red-500"></div>
      <div class="hover:bg-blue-500 focus:bg-blue-500"></div>
      <div class="hover:bg-gray-500 focus:bg-gray-500"></div>
      <div class="hover:bg-indigo-800 focus:bg-indigo-800"></div>
      <div class="hover:bg-pink-800 focus:bg-pink-800"></div>
    </div>
    
    <div class="flex flex-row flex-wrap justify-center items-center mx-auto gap-4">
      
      <a
        href="mailto:subhrajyotyroy@gmail.com"
        target="_blank"
        class="m-2 p-4 h-[55px] w-[55px] flex justify-center items-center
                    rounded-full border-2 border-white border-solid text-white transition-all 
                    duration-300 ease-in-out
                    hover:bg-red-500 focus:bg-red-500 hover:text-white focus:text-white"
      >
        <i class="fas fa-envelope fa-2x"></i>
      </a>
      
      <a
        href="https://www.facebook.com/subroy13/"
        target="_blank"
        class="m-2 p-4 h-[55px] w-[55px] flex justify-center items-center
                    rounded-full border-2 border-white border-solid text-white transition-all 
                    duration-300 ease-in-out
                    hover:bg-blue-500 focus:bg-blue-500 hover:text-white focus:text-white"
      >
        <i class="fab fa-facebook fa-2x"></i>
      </a>
      
      <a
        href="https://github.com/subroy13"
        target="_blank"
        class="m-2 p-4 h-[55px] w-[55px] flex justify-center items-center
                    rounded-full border-2 border-white border-solid text-white transition-all 
                    duration-300 ease-in-out
                    hover:bg-gray-500 focus:bg-gray-500 hover:text-white focus:text-white"
      >
        <i class="fab fa-github fa-2x"></i>
      </a>
      
      <a
        href="https://www.linkedin.com/in/subroy13"
        target="_blank"
        class="m-2 p-4 h-[55px] w-[55px] flex justify-center items-center
                    rounded-full border-2 border-white border-solid text-white transition-all 
                    duration-300 ease-in-out
                    hover:bg-indigo-800 focus:bg-indigo-800 hover:text-white focus:text-white"
      >
        <i class="fab fa-linkedin-in fa-2x"></i>
      </a>
      
      <a
        href="#"
        target="_blank"
        class="m-2 p-4 h-[55px] w-[55px] flex justify-center items-center
                    rounded-full border-2 border-white border-solid text-white transition-all 
                    duration-300 ease-in-out
                    hover:bg-pink-800 focus:bg-pink-800 hover:text-white focus:text-white"
      >
        <i class="fab fa-instagram fa-2x"></i>
      </a>
      
    </div>
  </div>
</section>


<footer class="bg-neutral-900 text-center text-white">
    
    <div class="text-center px-0 py-4 w-full" style="background-color: rgba(0, 0, 0, 0.2)">
        © 2023 Copyright:
        <a class="text-white" href="//localhost:1313/">StatWizard.in</a>
    </div>
</footer>

    </div>

    <script>
    $(document).ready(() => {

        
        $('#mobile-menu-button').click(() => {
            $('#mobile-menu').toggleClass('hidden');
            $('#mobile-menu-close-icon').toggleClass('hidden');
            $('#mobile-menu-close-icon').toggleClass('block');
            $('#mobile-menu-open-icon').toggleClass('hidden');
            $('#mobile-menu-open-icon').toggleClass('block');
        });

    });
</script>
<script data-name="BMC-Widget" data-cfasync="false" src="https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js" data-id="statwizard" data-description="Support me on Buy me a coffee!" data-message="Thank you for visiting! You can now support the StatWizard to build a Hogwarts for Statistics!" data-color="#5F7FFF" data-position="Right" data-x_margin="18" data-y_margin="18"></script>

<script async src="https://kit.fontawesome.com/ca14d5004b.js" crossorigin="anonymous"></script>

    


    <script type="module" defer>
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ startOnLoad: true, securityLevel: "loose" });
    </script>



    
    <script defer>
        MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
            },
            svg: {
                fontCache: 'global'
            }
        };
    </script>
    <script id="MathJax-script" defer src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.min.js"></script>



</body>
</html>